import { describe, test } from "vitest";
import { eachIndex } from "~/src/helpers.js";
import { SequenceRunner } from "../framework.js";
import { EMPTY } from "../shared.js";

export const data = (run: SequenceRunner) => {
  describe("Blocked Smart-fill", () => {
    for (const [i, data] of eachIndex([
      [
        "A Up",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │>B   │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │. 1  │. 1  │.  4 │.  4 │.  4 │.  5 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │. 1  │. 1  │>B   │.  4 │  b  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  5 │ B   │.11  │.324 │.424 │.214 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.11  │.11  │.114 │.53  │*64  │.32  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.12  │.12  │  b  │.32  │.43  │.214 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.114 │.11  │.  5 │.115 │.114 │  b  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "A Down (one sequence to auto-fill)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │>B   │.114 │.115 │.  5 │.11  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.214 │.43  │.32  │  b  │.12  │.12  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.32  │*64  │.53  │.114 │.11  │.11  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.214 │.424 │.324 │.11  │  b  │.  5 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │  b  │.  4 │  b  │. 1  │. 1  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  5 │.  4 │.  4 │.  4 │. 1  │. 1  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "C Up (two sequence to auto-fill)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │>B   │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.  3 │.  4 │. 1  │. 1  │  b  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │ B   │. 14 │. 1  │.114 │.11  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.11  │.12  │.114 │  b  │.22  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.11  │.12  │.22  │.223 │*53  │.42  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B   │.114 │.223 │.43  │.32  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │.  3 │     │  b  │.114 │.114 │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "D Left (three sequence to auto-fill)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │>B   │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │ B   │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │>B   │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.11  │.114 │.  4 │.114 │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.22  │.22  │ B   │.11  │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.324 │*43  │.324 │.214 │  b  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.214 │.32  │*43  │.33  │.114 │ B   │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │  b  │.214 │.22  │.12  │. 14 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │>B   │. 14 │. 1  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
    ])) {
      test(`auto-fills once enough blocked items have been filled in (test case ${i} ${data[0]})`, async () => {
        await run(EMPTY, ...data.slice(1));
      });
    }

    for (const [i, data] of eachIndex([
      // Edge Cases
      ["No blocked tiles provided", EMPTY],
      // 4 of 5 blocked tiles entered by the user
      [
        "D Left (four of five blocked tiles contain user-entered data; first blocked tile index auto-filled)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.11  │.114 │.  4 │.114 │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.22  │.22  │  b  │.11  │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.324 │*43  │.324 │.214 │>B1  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.214 │.32  │*43  │.33  │.114 │>B2  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B3  │.214 │.22  │.12  │. 14 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │>B4  │. 14 │. 1  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "D Left (four of five blocked tiles contain user-entered data; second blocked tile index auto-filled)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.11  │.114 │.  4 │.114 │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.22  │.22  │>B1  │.11  │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.324 │*43  │.324 │.214 │  b  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.214 │.32  │*43  │.33  │.114 │>B2  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B3  │.214 │.22  │.12  │. 14 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │>B4  │. 14 │. 1  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "D Left (four of five blocked tiles contain user-entered data; third blocked tile index auto-filled)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.11  │.114 │.  4 │.114 │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.22  │.22  │>B1  │.11  │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.324 │*43  │.324 │.214 │>B2  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.214 │.32  │*43  │.33  │.114 │  b  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B3  │.214 │.22  │.12  │. 14 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │>B4  │. 14 │. 1  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "D Left (four of five blocked tiles contain user-entered data; fourth blocked tile index auto-filled)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.11  │.114 │.  4 │.114 │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.22  │.22  │>B1  │.11  │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.324 │*43  │.324 │.214 │>B2  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.214 │.32  │*43  │.33  │.114 │>B3  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │  b  │.214 │.22  │.12  │. 14 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │>B4  │. 14 │. 1  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "D Left (four of five blocked tiles contain user-entered data; fifth blocked tile index auto-filled)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.11  │.114 │.  4 │.114 │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.22  │.22  │>B1  │.11  │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.324 │*43  │.324 │.214 │>B2  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.214 │.32  │*43  │.33  │.114 │>B3  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B4  │.214 │.22  │.12  │. 14 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │  b  │. 14 │. 1  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      // 5 of 5 blocked tiles entered by the user
      [
        "D Left (five of five blocked tiles contain user-entered data)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.11  │.114 │.  4 │.114 │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.22  │.22  │>B1  │.11  │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.324 │*43  │.324 │.214 │>B2  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.214 │.32  │*43  │.33  │.114 │>B3  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B4  │.214 │.22  │.12  │. 14 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │>B5  │. 14 │. 1  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      // Misc order of blocked tiles check
      [
        "D Left (order of user-entered data should not matter)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.11  │.114 │.  4 │.114 │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.22  │.22  │  b  │.11  │.12  │.114 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.324 │*43  │.324 │.214 │>B3  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.214 │.32  │*43  │.33  │.114 │>B2  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B1  │.214 │.22  │.12  │. 14 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │  b  │. 14 │. 1  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      // No community data
      [
        "handles blocked tile patterns with no community data (1 tile entered)",
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │>B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
      ],
      [
        "handles blocked tile patterns with no community data (2 tiles entered)",
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │>B1  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B2  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
      ],
      [
        "handles blocked tile patterns with no community data (3 tiles entered)",
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │>B1  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B2  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B3  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
      ],
      [
        "handles blocked tile patterns with no community data (4 tiles entered)",
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │>B1  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B2  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B3  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B4  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
      ],
      [
        "handles blocked tile patterns with no community data (5 tiles entered)",
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │>B1  │.21  │.42  │.42  │.21  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B2  │.42  │.84  │.84  │.42  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B3  │.52  │*a4  │*a4  │.52  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B4  │.52  │*a4  │*a4  │.52  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B5  │.42  │.84  │.84  │.42  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │.21  │.42  │.42  │.21  │
      └─────┴─────┴─────┴─────┴─────┴─────┘
      [Warning] Blocked tile pattern does not match any known patterns; Fox suggestions are not available.
    `,
      ],
    ])) {
      test(`${data[0]} (test case index ${i})`, async () => {
        await run(EMPTY, ...data.slice(1));
      });
    }

    test("reports issue when there are more than 5 blocked tiles entered by the user (6 tiles entered)", async () => {
      await run(
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │ B   │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ B   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │>B   │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │ B   │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ B   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
      [Error] Board has 6 blocked tiles, but there should only be 5. # Issues: 0, 8, 16, 23, 25, 33
    `
      );
    });
    test("reports issue when there are more than 5 blocked tiles entered by the user (7 tiles entered)", async () => {
      await run(
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │ B   │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ B   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │>B1  │>B2  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │ B   │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ B   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
      [Error] Board has 7 blocked tiles, but there should only be 5. # Issues: 0, 1, 8, 16, 23, 25, 33
    `
      );
    });
  });
};
