import { eachIndex } from "~/src/helpers.js";
import { TestStructuralElements } from "../all-data-tests.js";
import { RegisterTest } from "../framework.js";
import { EMPTY } from "../shared.js";

export const data = (
  registerTest: RegisterTest,
  { describe }: TestStructuralElements
) => {
  describe("Blocked Smart-fill", () => {
    for (const [i, data] of eachIndex([
      [
        "A Up",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │>B   │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │. 5  │. 5  │.  4 │.  4 │.  4 │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │. 5  │. 5  │>B   │.  4 │  b  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │ B   │.22  │.624 │.814 │.414 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.43  │.43  │.224 │.a2  │*c2  │.62  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.45  │.45  │  b  │.62  │.83  │.414 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.424 │.42  │.  4 │.224 │.224 │  b  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "A Down (one sequence to auto-fill)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │>B   │.224 │.224 │.  4 │.42  │.424 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.414 │.83  │.62  │  b  │.45  │.45  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.62  │*c2  │.a2  │.224 │.43  │.43  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.414 │.814 │.624 │.22  │  b  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │  b  │.  4 │  b  │. 5  │. 5  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │.  4 │.  4 │.  4 │. 5  │. 5  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "C Up (two sequence to auto-fill)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │>B   │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.  3 │.  4 │. 4  │. 4  │  b  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │ B   │. 44 │. 4  │.224 │.22  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.14  │.16  │.124 │  b  │.42  │.424 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.14  │.16  │.34  │.623 │*e   │.c   │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B   │.224 │.623 │.c1  │.a1  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │.  3 │     │  b  │.414 │.414 │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "D Left (three sequence to auto-fill)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │>B   │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │ B   │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │>B   │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │     │     │     │     │     │     │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.23  │.234 │.  4 │.234 │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.43  │.43  │ B   │.23  │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.634 │*83  │.814 │.614 │  b  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.434 │.63  │.a1  │.82  │.214 │ B   │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │  b  │.6 4 │.61  │.24  │. 34 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │>B   │. 34 │. 3  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
    ])) {
      registerTest(
        `auto-fills once enough blocked items have been filled in (test case [${i}] "${data[0]}")`,
        EMPTY,
        ...data.slice(1)
      );
    }

    for (const [i, data] of eachIndex([
      // Edge Cases
      ["No blocked tiles provided", EMPTY],
      // 4 of 5 blocked tiles entered by the user
      [
        "D Left (four of five blocked tiles contain user-entered data; first blocked tile index auto-filled)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.23  │.234 │.  4 │.234 │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.43  │.43  │  b  │.23  │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.634 │*83  │.814 │.614 │>B1  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.434 │.63  │.a1  │.82  │.214 │>B2  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B3  │.6 4 │.61  │.24  │. 34 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │>B4  │. 34 │. 3  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "D Left (four of five blocked tiles contain user-entered data; second blocked tile index auto-filled)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.23  │.234 │.  4 │.234 │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.43  │.43  │>B1  │.23  │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.634 │*83  │.814 │.614 │  b  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.434 │.63  │.a1  │.82  │.214 │>B2  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B3  │.6 4 │.61  │.24  │. 34 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │>B4  │. 34 │. 3  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "D Left (four of five blocked tiles contain user-entered data; third blocked tile index auto-filled)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.23  │.234 │.  4 │.234 │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.43  │.43  │>B1  │.23  │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.634 │*83  │.814 │.614 │>B2  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.434 │.63  │.a1  │.82  │.214 │  b  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B3  │.6 4 │.61  │.24  │. 34 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │>B4  │. 34 │. 3  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "D Left (four of five blocked tiles contain user-entered data; fourth blocked tile index auto-filled)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.23  │.234 │.  4 │.234 │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.43  │.43  │>B1  │.23  │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.634 │*83  │.814 │.614 │>B2  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.434 │.63  │.a1  │.82  │.214 │>B3  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │  b  │.6 4 │.61  │.24  │. 34 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │>B4  │. 34 │. 3  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      [
        "D Left (four of five blocked tiles contain user-entered data; fifth blocked tile index auto-filled)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.23  │.234 │.  4 │.234 │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.43  │.43  │>B1  │.23  │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.634 │*83  │.814 │.614 │>B2  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.434 │.63  │.a1  │.82  │.214 │>B3  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B4  │.6 4 │.61  │.24  │. 34 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │  b  │. 34 │. 3  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      // 5 of 5 blocked tiles entered by the user
      [
        "D Left (five of five blocked tiles contain user-entered data)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.23  │.234 │.  4 │.234 │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.43  │.43  │>B1  │.23  │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.634 │*83  │.814 │.614 │>B2  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.434 │.63  │.a1  │.82  │.214 │>B3  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B4  │.6 4 │.61  │.24  │. 34 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │>B5  │. 34 │. 3  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      // Misc order of blocked tiles check
      [
        "D Left (order of user-entered data should not matter)",
        `
          ┌─────┬─────┬─────┬─────┬─────┬─────┐
          │.23  │.234 │.  4 │.234 │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.43  │.43  │  b  │.23  │.25  │.224 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.634 │*83  │.814 │.614 │>B3  │.  4 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.434 │.63  │.a1  │.82  │.214 │>B2  │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │>B1  │.6 4 │.61  │.24  │. 34 │
          ├─────┼─────┼─────┼─────┼─────┼─────┤
          │.  4 │     │     │  b  │. 34 │. 3  │
          └─────┴─────┴─────┴─────┴─────┴─────┘
        `,
      ],
      // No community data
      [
        "handles blocked tile patterns with no community data (1 tile entered)",
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │>B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
      ],
      [
        "handles blocked tile patterns with no community data (2 tiles entered)",
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │>B1  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B2  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
      ],
      [
        "handles blocked tile patterns with no community data (3 tiles entered)",
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │>B1  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B2  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B3  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
      ],
      [
        "handles blocked tile patterns with no community data (4 tiles entered)",
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │>B1  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B2  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B3  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B4  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
      ],
      [
        "handles blocked tile patterns with no community data (5 tiles entered)",
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │>B1  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B2  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B3  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B4  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │>B5  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
      [Error] Tile pattern does not match any known patterns; suggestions are not available.
      [Warning] Blocked tile pattern does not match any known patterns; Fox suggestions are not available.
    `,
      ],
    ])) {
      registerTest(
        `${data[0]} (test case index ${i})`,
        EMPTY,
        ...data.slice(1)
      );
    }

    registerTest(
      "reports issue when there are more than 5 blocked tiles entered by the user (6 tiles entered)",
      `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │ B   │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ B   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
      `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │>B   │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │ B   │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ B   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
      [Error] Board has 6 blocked tiles, but there should only be 5. # Issues: 0, 8, 16, 23, 25, 33
    `
    );
    registerTest(
      "reports issue when there are more than 5 blocked tiles entered by the user (7 tiles entered)",
      `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │ B   │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ B   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
      `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │>B1  │>B2  │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │ B   │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ B   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
      [Error] Board has 7 blocked tiles, but there should only be 5. # Issues: 0, 1, 8, 16, 23, 25, 33
    `
    );
  });
};
