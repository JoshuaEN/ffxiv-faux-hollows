import { describe, test } from "vitest";
import { SequenceRunner } from "../framework.js";

export const data = (run: SequenceRunner) => {
  describe("Smart-fill Edge cases", () => {
    test(`Present smart-fill invalidates candidates for Sword`, async () => {
      await run(
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │.  1 │     │     │ B   │.  1 │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │.  1 │     │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │.  1 │ B   │.1   │.1   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │  p  │  p  │  s  │  s  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │.  1 │ B   │>P   │  p  │  s  │  s  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │.  1 │     │     │ B   │*1 1 │*1 1 │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `
      );
    });
    test(`Sword smart-fill invalidates candidates for Present`, async () => {
      await run(
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ E   │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │ E   │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │.  1 │ B   │.  1 │ E   │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │* 1  │  p  │* 1  │ B   │     │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │* 1  │  p  │* 1  │  s  │  s  │  s  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │.  1 │ B   │.  1 │  s  │  s  │>S   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │ E   │.  1 │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `
      );
    });
    test(`Sword smart-fill invalidates candidates for Present, leads to solved Present`, async () => {
      await run(
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ B   │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │ E   │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ B   │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │  p  │  p  │ E   │*1  s│*1  s│     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │  p  │  p  │*1  s│  s  │  s  │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │*1  s│>S   │  s  │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
      [Warning] Blocked tile pattern does not match any known patterns; Fox suggestions are not available.
    `
      );
    });
    test(`Sword smart-fill invalidates candidates for Present, leading to fully solved board`, async () => {
      await run(
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ E   │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ E   │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │  p  │  p  │     │ B   │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │  p  │  p  │  s  │  s  │  s  │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │  s  │>S   │  s  │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `
      );
    });
    test(`Present smart-fill invalidates candidates for Sword, leads to solved Sword`, async () => {
      await run(
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ B   │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │ E   │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ B   │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │ E   │  s  │  s  │  s  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │  s  │  s  │  s  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │>P   │  p  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │  p  │  p  │
      └─────┴─────┴─────┴─────┴─────┴─────┘
      [Warning] Blocked tile pattern does not match any known patterns; Fox suggestions are not available.
    `
      );
    });
    // test(`Present smart-fill invalidates candidates for Sword, leads to solved Sword`, async () => {
    //   await run(
    //     `
    //   ┌─────┬─────┬─────┬─────┬─────┬─────┐
    //   │     │     │     │     │ B   │     │
    //   ├─────┼─────┼─────┼─────┼─────┼─────┤
    //   │     │ B   │     │ B   │ E   │     │
    //   ├─────┼─────┼─────┼─────┼─────┼─────┤
    //   │     │     │ E   │     │     │     │
    //   ├─────┼─────┼─────┼─────┼─────┼─────┤
    //   │     │     │     │     │     │     │
    //   ├─────┼─────┼─────┼─────┼─────┼─────┤
    //   │     │ B   │     │     │     │     │
    //   ├─────┼─────┼─────┼─────┼─────┼─────┤
    //   │     │     │     │ B   │     │     │
    //   └─────┴─────┴─────┴─────┴─────┴─────┘
    // `,
    //     `
    //   ┌─────┬─────┬─────┬─────┬─────┬─────┐
    //   │     │     │     │     │ B   │     │
    //   ├─────┼─────┼─────┼─────┼─────┼─────┤
    //   │     │ B   │     │ B   │ E   │     │
    //   ├─────┼─────┼─────┼─────┼─────┼─────┤
    //   │     │     │ E   │     │     │     │
    //   ├─────┼─────┼─────┼─────┼─────┼─────┤
    //   │     │     │     │     │     │     │
    //   ├─────┼─────┼─────┼─────┼─────┼─────┤
    //   │     │ B   │     │     │     │     │
    //   ├─────┼─────┼─────┼─────┼─────┼─────┤
    //   │     │     │     │ B   │     │     │
    //   └─────┴─────┴─────┴─────┴─────┴─────┘
    //   [Warning] Blocked tile pattern does not match any known patterns; Fox suggestions are not available.
    // `
    //   );
    // });
    test(`Present smart-fill invalidates candidates for Sword, leading to fully solved board`, async () => {
      await run(
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ E   │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
        `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ E   │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │  p  │  p  │     │ B   │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │>P   │  p  │  s  │  s  │  s  │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │  s  │  s  │  s  │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `
      );
    });
  });
  test(`Out-of-bounds should be ignored when calculating valid spots`, async () => {
    await run(
      `
    ┌─────┬─────┬─────┬─────┬─────┬─────┐
    │     │     │     │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │ B   │     │ B   │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │ B   │ E   │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │     │     │     │ E   │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │ B   │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │ F   │ E   │     │     │     │ B   │
    └─────┴─────┴─────┴─────┴─────┴─────┘
  `,
      `
    ┌─────┬─────┬─────┬─────┬─────┬─────┐
    │>P   │  p  │     │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │  p  │  p  │ B   │     │ B   │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │ B   │ E   │*1   │*1   │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │     │  s  │  s  │ E   │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │ B   │  s  │  s  │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │ F   │ E   │     │*1   │*1   │ B   │
    └─────┴─────┴─────┴─────┴─────┴─────┘
  `
    );
  });
  test.skip(`Shapes with smart-fill information (sowrd/presents) but no user-entered tiles for that shape should trigger suggestions within the smart-fill area`, async () => {
    await run(
      `
    ┌─────┬─────┬─────┬─────┬─────┬─────┐
    │     │     │ B   │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │     │ P   │ B   │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │ B   │     │ P   │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │ B   │     │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │     │ B   │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │     │     │     │     │
    └─────┴─────┴─────┴─────┴─────┴─────┘
  `,
      `
    ┌─────┬─────┬─────┬─────┬─────┬─────┐
    │     │     │ B   │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │  p  │ P   │ B   │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │ B   │     │ P   │  p  │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │ B   │     │     │*2   │*2   │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │>E   │     │ B   │*2   │*2   │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │     │     │     │     │
    └─────┴─────┴─────┴─────┴─────┴─────┘
  `
    );
  });
  test.skip(`Suggestions should be displayed correctly when two incomplete shapes are present due to user input`, async () => {
    await run(
      `
    ┌─────┬─────┬─────┬─────┬─────┬─────┐
    │     │     │ B   │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │     │     │ B   │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │ B   │     │     │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │ B   │     │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │ P   │     │ B   │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │     │     │     │     │
    └─────┴─────┴─────┴─────┴─────┴─────┘
  `,
      `
    ┌─────┬─────┬─────┬─────┬─────┬─────┐
    │     │     │ B   │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │     │     │ B   │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │ B   │     │.1  s│.2  s│*3  s│.2  s│
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │ B   │.1  s│.2  s│>S   │*3  s│
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │. 1 p│ P   │. 1 p│ B   │.2  s│.2  s│
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │. 1 p│  p  │. 1 p│     │.1  s│.1  s│
    └─────┴─────┴─────┴─────┴─────┴─────┘
  `
    );
  });
};
