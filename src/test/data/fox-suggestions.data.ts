import { it } from "node:test";
import { describe, test } from "vitest";
import { SequenceRunner } from "../framework";
import { EMPTY } from "../shared";

export const data = (run: SequenceRunner) => {
  describe("Fox suggestions", () => {
    describe("Fully Solved board", () => {
      test(`Does not suggest any foxes with no community data`, async () => {
        await run(
          `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ E   │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
          `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ E   │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │  p  │  p  │     │ B   │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │  p  │  p  │  s  │  s  │  s  │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │  s  │>S   │  s  │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `
        );
      });
      test(`Does not suggest any foxes with an unknown block pattern and no community data`, async () => {
        await run(
          `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │ B   │ B   │ B   │ B   │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ E   │     │ E   │     │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │ E   │     │ E   │     │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ E   │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │ E   │     │     │     │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
          `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │ B   │ B   │ B   │ B   │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ E   │     │ E   │     │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │ E   │     │ E   │     │ E   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │  s  │  s  │  s  │     │     │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │>S   │  s  │  s  │ E   │  p  │  p  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │ E   │     │     │     │  p  │  p  │
      └─────┴─────┴─────┴─────┴─────┴─────┘
      [Warning] Blocked tile pattern does not match any known patterns; Fox suggestions are not available.
    `
        );
      });
      test(`Suggests foxes with community data`, async () => {
        await run(
          `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ E   │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
          `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │*  1 │     │     │ B   │*  1 │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ E   │>P2  │  p  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │*  1 │ B   │  p  │  p  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │  s  │  s  │  s  │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │  s  │>S1  │  s  │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │*  1 │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `
        );
      });
      test(`No longer suggests foxes once a fox has been entered`, async () => {
        await run(
          `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ E   │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │     │     │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │     │     │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
          `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │*  1 │     │     │ B   │*  1 │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ E   │>P2  │  p  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │*  1 │ B   │  p  │  p  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │  s  │  s  │  s  │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │  s  │>S1  │  s  │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │*  1 │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `,
          `
      ┌─────┬─────┬─────┬─────┬─────┬─────┐
      │     │     │     │     │ B   │>F   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │     │ E   │ P   │  p  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │  p  │  p  │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │  s  │  s  │  s  │ E   │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │ B   │  s  │ S   │  s  │     │
      ├─────┼─────┼─────┼─────┼─────┼─────┤
      │     │     │     │ B   │     │     │
      └─────┴─────┴─────┴─────┴─────┴─────┘
    `
        );
      });
    });
    describe("Partially Solved board", () => {
      test("Does not suggest any foxes with no community data", async () => {
        await run(
          `
    ┌─────┬─────┬─────┬─────┬─────┬─────┐
    │     │     │     │     │ B   │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │ B   │     │ E   │ E   │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │     │ B   │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │ E   │     │     │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │ B   │     │     │     │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │     │ B   │     │     │
    └─────┴─────┴─────┴─────┴─────┴─────┘
  `,
          `
    ┌─────┬─────┬─────┬─────┬─────┬─────┐
    │     │     │     │     │ B   │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │ B   │     │ E   │ E   │     │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │. 1  │. 1  │ B   │.1  s│.1  s│
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │ E   │. 1  │  p  │*11 s│  s  │>S   │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │ B   │. 1  │*11 s│  s  │  s  │
    ├─────┼─────┼─────┼─────┼─────┼─────┤
    │     │     │     │ B   │.1  s│.1  s│
    └─────┴─────┴─────┴─────┴─────┴─────┘
  `
        );
      });
      test(`Correctly detects Sword orientation for determining valid foxes (2x3)`, async () => {
        await run(
          `
        ┌─────┬─────┬─────┬─────┬─────┬─────┐
        │     │     │     │     │     │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │     │ B   │     │ B   │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │ B   │     │ S   │     │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │     │     │     │     │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │     │ B   │     │ S   │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │ E   │     │     │     │ B   │
        └─────┴─────┴─────┴─────┴─────┴─────┘
      `,
          `
        ┌─────┬─────┬─────┬─────┬─────┬─────┐
        │     │     │     │     │     │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │     │ B   │*  1 │ B   │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │ B   │     │ S   │  s  │*  1 │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │  p  │  p  │     │  s  │  s  │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │>P   │  p  │ B   │  s  │ S   │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │ E   │*  1 │*  1 │*  1 │ B   │
        └─────┴─────┴─────┴─────┴─────┴─────┘
      `
        );
      });
    });
    describe("Recommendation prioritization", () => {
      test(`Other things equal, should prioritize spots that may have a fox`, async () => {
        await run(
          `
        ┌─────┬─────┬─────┬─────┬─────┬─────┐
        │     │     │     │     │ B   │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │ B   │     │     │ E   │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │     │     │ B   │     │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │     │     │     │     │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │ B   │     │     │     │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │     │     │ B   │     │     │
        └─────┴─────┴─────┴─────┴─────┴─────┘
      `,
          `
        ┌─────┬─────┬─────┬─────┬─────┬─────┐
        │     │.  1 │     │     │ B   │.  1 │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │ B   │.  1 │     │ E   │     │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │     │.  1 │ B   │.1   │.1   │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │     │     │  p  │  p  │  s  │  s  │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │.  1 │ B   │>P   │  p  │  s  │  s  │
        ├─────┼─────┼─────┼─────┼─────┼─────┤
        │.  1 │     │     │ B   │*1 1 │*1 1 │
        └─────┴─────┴─────┴─────┴─────┴─────┘
      `
        );
      });
    });
  });
};
